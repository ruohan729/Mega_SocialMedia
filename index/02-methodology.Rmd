# Methodology {#methodology .unnumbered}

## Data {#methodology-data .unnumbered}

The data used to predict Coca-Cola bag orders will come from three distinct sources: Scholle IPN, Twitter, and Google Trends.  The aggregation of all relevant data will be at the monthly level with a date range from October 2009 to October 2018.  This will ensure that the data will have enough observations for our forecasting models.  The dependent variable for this project will be the monthly total bag orders from Coca-Cola, which will be calculated using Scholle IPN’s internal sales data.  The independent variables are social media variables collected from Twitter and Google Trends.
Twitter is a widely used social media platform in the United States and Canada that was founded in 2006.  This platform will allow us to get a feeling about users and their opinions on Coca-Cola, Pepsi, McDonald’s, Taco Bell, and ‘jobs’.  Most importantly, Twitter gives users access to data elements about a tweet necessary for this project, including the date a tweet was posted and the reactions a tweet received (i.e. number of likes, replies, and retweets).  Twitter’s years of existence, popularity, and data features make it an ideal social media data source for this project.  However, Twitter does have a number of limitations.  One of the main disadvantages of using Twitter data is its high volume and high dimensionality.  Twitter receives millions of tweets a day that has information about the actual tweet (number of likes, replies, etc.), the user who posted the tweet (username, location, etc.) and the users who interact with the tweet (replied to tweet, username, etc.).  A well defined scope will limit the amount of tweets to be collected and will allow us to prepare for any data storage and computational needs.	  
Google Trends will give us an opportunity to see how frequently internet users search for Coca-Cola, Pepsi, McDonald’s, Pepsi, and ‘jobs’ in Google.  The main advantage of Google Trends is the ease in which we are able to collect this data.  Google Trends allow users to select aggregate level (monthly, annual), location, and a date range for each query.  The main disadvantage of Google Trends is that the raw data used to generate the trend value is not available.  This makes it challenging to validate unusual trends in a search query. 
For more information on the specific variables, please refer to the Social Media Variables section. For more information on how the social media data were collected, please refer to Appendix A.  Below is a summary table of the monthly social media variables:

## Exploratory Data Analysis {#methodology-descriptive .unnumbered} 

In order to ensure maximum utility of the collected social media data and produce accurate Coca-Cola bag order forecasts, it is important to conduct exploratory analysis on these variables.  Analyzing all the variables prior to modeling will allow us to better understand trends in our variables.  Identifying these trends can aid in the interpretation of our forecasting results.  In this section, we will provide a brief analysis of each variable and highlight trends that could be of value when predicting the demand for Coca-Cola bag orders. 

Above is a time plot of monthly Coca-Cola syrup bag orders from October 2009 to October 2019.   At a glance, we observe an annual seasonal pattern with no consistent trend over time.  Overall, the bag quantity orders show a mean of 7,521,158 per month.  Expectedly, Scholle IPN experience the highest volume of Coca-Cola bag orders during summer months (June-August) with averages over eight million ordered bags.  The only other month with an average of over eight million Coca-Cola bags is during the month of March.

**User-generated Tweets
User-generated tweets provides our forecasting models with information regarding how frequently Twitter users talk about Coca-Cola, Pepsi, McDonald’s, Taco Bell, and “jobs”.  When looking  at the average monthly tweet mentions for each term, the term “jobs” surprisingly appeared the most.  Jobs-related tweets in the dataset represent 42.7% of all the user-generated tweets collected.  The visual below of the average monthly tweet volume for each selected term demonstrates how “jobs” dominated our collected data.  
The disparity on tweet volume across topics can be explained by the limitations imposed by the Twitter Search API (please refer to the Appendix for more information).  Originally, we did not anticipate the general public to engage in job-related conversation on a social media platform compared to the other relevant terms.  This finding provides value to our analysis as the term “jobs” now has a large sample size and can potentially give us better indication on how economic activity in North America impact Coca-Cola bag orders.  However, this resulted in a lower total of user-generated tweets for all other relevant terms.  Limited sample size for these variables could adversely impact their ability to forecast Coca-Cola bag orders.

**Company-generated Tweets
	To continue the exploration of covariates, we will explore company-generated tweets.  This set of social media variables will provide us information about promotional behavior for these selected companies (monthly tweets) and the subsequent consumer reaction to these promotions (monthly likes, retweets and replies).  A total of 24,442 such tweets were collected between October 2009 to October 2018.  Among the four companies, the official Twitter accounts of Coca-Cola and McDonald’s were the most active in terms of posting Twitter content.  The time series plots below (not built to scale) clearly show a general trend among all four companies.  

For each company, the total number of tweets per month were low in the beginning portion of the time plot. This was followed by a surge in tweet volume in the middle part of the decade suggesting how all four companies started to heavily utilize Twitter as a promotional tool.  This change in behavior from companies could be attributed to the increased use of Twitter by social media consumers around the same time.  The time plots below (not built to scale) of total consumer reactions (replies, likes, retweets) is a representation of how Twitter users who engaged with each company reacted to their tweets over time.  

Noticeably, Twitter users became much more engaged with these Twitter accounts towards the middle portion of the time plots.  This could be a sign of how effective these company’s promotions are during the middle of the decade, or it could be an indicator of when social media started becoming more popular in mainstream society.  The limited Twitter activity by the Twitter accounts and users during the earlier portion of the time plots should be considered when modeling.

**Google Trends	
Although Google Trends is not a social media platform, it does provide an easily attainable source of data regarding general interest in Coca-Cola, Pepsi, McDonald’s, Taco Bell, and ‘jobs’.  This could provide useful information when forecasting Coca-Cola bag orders. 
Above are time series plots for each term and their monthly Google Trend value from October 2009 to October 2018.  Generally, there seems to be a seasonal trend that appear for each search term.  It is interesting to note that the two quick service restaurants, McDonald’s and Taco Bell, experienced an increasing trend over time.  
When using Google Trends, it is important to consider that trend values are calculated strictly based on the search term entered.  This strict rule could fail in certain instances where a single term could have different meanings.  For example, an unusual spike can be observed in the time series plot for ‘jobs’ in October 2011.  After conducting additional research, this spike can be attributed to a sudden interest in Steve Jobs when he passed away.   For Pepsi, a spike in April 2017 was traced back due to its connection to a controversial advertisement involving the celebrity Kendall Jenner.  These outliers will be imputed with a value that fit the distribution of the rest of the dataset.  


\newpage

## Modeling Framework {#methodology-modeling .unnumbered}

The following metrics are going to be used to measure the forecasting models we will build using social media variables.  
Symmetric Mean Absolute Percent Error (sMAPE) - A measure based on percentage (or relative) errors. 


**Metrics**

Transform `dose` into a `factor`. Only three dosage levels are present.

```{r transform}
data(ToothGrowth)
colnames(ToothGrowth) <- c("length", "supplement", "dose")
ToothGrowth$dose <- as.factor(ToothGrowth$dose)
```
 
We are most interested in discovering which treatment leads to the optimal tooth growth.
In this vein, we use `aggregate` function to transform our data and compute the average tooth `length` by both `supplement` type  and `dose` size.


```{r group, warning=FALSE}
groupedTooth <- aggregate(ToothGrowth, by=ToothGrowth[,2:3], FUN=mean)[,1:3]

kable(groupedTooth, align = "r", caption = "Average tooth length",
      format = "latex", longtable = TRUE)
```                   



\newpage

## Math and Science notation  {#math-sci .unnumbered}
<!-- Required to number equations in HTML files -->
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>

\TeX\ is the best way to typeset mathematics. Donald Knuth designed \TeX\ when he got frustrated at how long it was taking the typesetters to finish his book, which contained a lot of mathematics.  One nice feature of _R Markdown_ is its ability to read \LaTeX\ code directly.

Get around math mode's automatic italicizing in LaTeX by using the argument `$\mathrm{formula here}$`, with your formula inside the curly brackets.  (Notice the use of the backticks here which enclose text that acts as code.)

So, $\mathrm{Fe_2^{2+}Cr_2O_4}$ is written `$\mathrm{Fe_2^{2+}Cr_2O_4}$`.

The \noindent command below does what you'd expect:  it forces the current line/paragraph to not indent. See below and examples of commonly used symbols:

\noindent Exponent or Superscript written as `$x^2$` becomes $x^2$

\noindent Subscript written as `$x_1$` becomes $x_1$

\noindent Infinity written as `$\infty$` becomes $\infty$

\noindent alpha written as `$\alpha$` becomes $\alpha$

\noindent beta written as `$\beta$` becomes $\beta$

\noindent delta written as `$\delta$` becomes $\delta$

\noindent epsilon written as `$\epsilon$` becomes $\epsilon$

\noindent sigma written `$\sum_{i=1}^n f(x)$` becomes $\sum_{i=1}^n f(x)$

### Math Examples {.unnumbered}

An Ordinary Least Squares model, from _Introductory Econometrics, 6th edition_ by Jeffrey M. Wooldridge, page 27. 

$$y_i = \beta_0 + \beta_1 x_i + \epsilon_i$$ 

An infinite distributed lag (IDL) time series model, by Wooldridge, page 633.

$$ y_t = \alpha + \delta_0 z_t + \delta_1 z_{t-1} + \delta_2 z_{t-2} \ldots + \epsilon_t$$ 

A vector autoregressive (VAR) model, by Wooldridge, page 657. 

$$ y_t = \delta_0 + \alpha_1 y_{t-1} + \gamma_1 z_{t-1} + \alpha_2 y_{t-2} + \gamma_2 z_{t-2} \ldots,$$ 
\newpage
ddfdf
Determinant of a square matrix: 


$$\det\left|\,\begin{matrix}%
c_0&c_1\hfill&c_2\hfill&\ldots&c_n\hfill\cr
c_1&c_2\hfill&c_3\hfill&\ldots&c_{n+1}\hfill\cr
c_2&c_3\hfill&c_4\hfill&\ldots&c_{n+2}\hfill\cr
\,\vdots\hfill&\,\vdots\hfill&
  \,\vdots\hfill&&\,\vdots\hfill\cr
c_n&c_{n+1}\hfill&c_{n+2}\hfill&\ldots&c_{2n}\hfill\cr
\end{matrix}\right|>0$$ 

\bigskip

A regularization problem solved by Jerome Friedman, Trevor Hastie, Rob Tibshirani and Noah Simon, implemented in the [R package `glmnet`](https://cran.r-project.org/web/packages/glmnet/index.html). 


$$ \min_{\beta_0,\beta} \frac{1}{N}\sum_{i=1}^N w_il(y_i,\beta_0+\beta^Tx_i)+\lambda \left[(1-\alpha) ||\beta||_2^2/2+\alpha||\beta||_1\right]$$ 

\bigskip

From Lapidus and Pindar, Numerical Solution of Partial Differential Equations in Science and Engineering, page 54. 

$$\int_t\left\{\sum_{j=1}^3 T_j \left({d\phi_j\over dt}+k\phi_j\right)-kT_e\right\}w_i(t)\ dt=0, \qquad\quad i=1,2,3.$$ 

\bigskip
  
From Lapidus and Pindar, page 145. 

$$\int_{-1}^1\!\int_{-1}^1\!\int_{-1}^1 f\big(\xi,\eta,\zeta\big) = \sum_{k=1}^n\sum_{j=1}^n\sum_{i=1}^n w_i w_j w_k f\big( \xi,\eta,\zeta\big).$$ 



### Additional R Markdown and bookdown resources {.unnumbered}

- _Bookdown_ Online Book - <https://bookdown.org/yihui/bookdown/>

- _Markdown_ Info Sheet - <https://github.com/adam-p/markdown-here/wiki/Markdown-Cheatsheet>

- _R Markdown_ Reference Guide - <https://www.rstudio.com/wp-content/uploads/2015/03/rmarkdown-reference.pdf>
